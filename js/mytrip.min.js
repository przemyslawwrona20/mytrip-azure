!function(t,e,n){e.module("mytrip",["ui.router","ui.bootstrap","mytrip.view.landing","mytrip.view.manager","mytrip.view.header","mytrip.view.home","mytrip.view.footer","mytrip.trip","mytrip.modal","mytrip.view.tripDetail","jcs-autoValidate","ngFileUpload","xeditable","ngLodash","ngProgress","ngMap"]).config(["$stateProvider","$urlRouterProvider","$httpProvider","$urlMatcherFactoryProvider","$locationProvider",function(t,e,n,r,i){n.defaults.headers.post["Content-Type"]="application/json",i.html5Mode(!1)}]).run(["$rootScope",function(t){String.prototype.startsWith=function(t){return this.substring(0,t.length)===t}}]).constant("STATES",{homeState:"app.home",landing:"landing"}).controller("AppCtrl",["$scope","$rootScope","$state","STATES",function(t,e,n,r){var i=r.homeState,o={};t.pageTitle="mytrip",e.$on("event:auth-loginConfirmed",function(){n.go(i,o),i=r.homeState,o={}}),e.$on("event:changeState-default",function(){n.go(r.homeState)}),n.go(r.landing),e.$on("$stateChangeStart",function(t,e,n,r,i){})}])}(window,window.angular),function(t,e,n){e.module("mytrip.directives.openFile",[]).constant("FILE_TYPE",{json:"json",txt:"txt"}).directive("openFile",[function(){return{restrict:"A",scope:{data:"=",model:"=?",format:"&?",parser:"=",errorMessage:"="},controller:"OpenFileCtrl"}}]).controller("OpenFileCtrl",["$scope","$element",function(t,e){t.format=t.format||"json";e.bind("change",function(e){var n=new FileReader;n.onload=function(e){t.$apply(function(){e.target.fileName;console.log(e.target.result),t.reportParser.parseTXT();void 0===t.model?t.data="":t.data=t.model.apiResponseTransformer("")})};var r=e.target.files[0];n.fileName=r.name,n.readAsText(r)})}])}(window,window.angular),function(t,e,n){e.module("mytrip.directives.particles",[]).directive("particles-js",function(t){return{restrict:"A",replace:!0,template:'<div class="particleJs" id="particleJs"></div>',link:function(e,n,r,i){t.particlesJS("particleJs",{particles:{color:"#52a5fd",shape:"circle",opacity:1,size:5.5,size_random:!0,nb:20,line_linked:{enable_auto:!0,distance:750,color:"#52a5fd",opacity:.5,width:2,condensed_mode:{enable:!1,rotateX:600,rotateY:600}},anim:{enable:!0,speed:2.5}},interactivity:{enable:!0,mouse:{distance:250},detect_on:"canvas",mode:"grab",line_linked:{opacity:.5},events:{onclick:{push_particles:{enable:!0,nb:4}}}},retina_detect:!0})}}})}(window,window.angular),function(t,e,n){e.module("mytrip.view.landing",["ui.router"]).config(function(t){t.state("landing",{url:"",controller:"LandingCtrl",templateUrl:"app/landing/landing.tpl.html"})}).controller("LandingCtrl",["$scope","$window",function(t,n){e.element(n).bind("scroll",function(){n.pageYOffset>50?t.$apply(function(){t.shrink=!0}):t.$apply(function(){t.shrink=!1})}),particlesJS("particles-js",{particles:{number:{value:150,density:{enable:!0,value_area:800}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"},polygon:{nb_sides:5},image:{src:"img/github.svg",width:100,height:100}},opacity:{value:.5,random:!1,anim:{enable:!1,speed:1,opacity_min:.1,sync:!1}},size:{value:3,random:!0,anim:{enable:!1,speed:40,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:150,color:"#ffffff",opacity:.4,width:1},move:{enable:!0,speed:3,direction:"none",random:!1,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},interactivity:{detect_on:"canvas",events:{onhover:{enable:!0,mode:"grab"},onclick:{enable:!0,mode:"push"},resize:!0},modes:{grab:{distance:150,line_linked:{opacity:1}},bubble:{distance:400,size:40,duration:2,opacity:8,speed:3},repulse:{distance:200,duration:.4},push:{particles_nb:4},remove:{particles_nb:2}}},retina_detect:!0})}])}(window,window.angular),function(t,e,n){e.module("mytrip.view.footer",["ui.router"]).controller("FooterCtrl",["$scope",function(t){}])}(window,window.angular),function(t,e,n){e.module("mytrip.view.header",["ui.router"]).controller("HeaderCtrl",["$scope",function(t){}])}(window,window.angular),function(t,e,n){e.module("mytrip.view.home",["ui.router"]).config(["$stateProvider",function(t){t.state("app.home",{url:"",views:{"manager@app":{controller:"HomeCtrl",templateUrl:"app/manager/home/home.tpl.html"}}})}]).controller("HomeCtrl",["$scope","$state",function(t,e){t.points=[{id:0,name:"",coordinates:{x:5e3,y:6e3},photoPath:""}]}])}(window,window.angular),function(){"use strict";angular.module("mytrip.modal",["ui.bootstrap"])}(),function(){"use strict";angular.module("mytrip.modal").factory("ModalService",["$rootScope","$uibModal",function(t,e){return{confirmation:function(t,n,r){return e.open({animation:!0,size:r,templateUrl:"app/manager/home/modalService/modalTemplate.tpl.html",resolve:{header:function(){return t},body:function(){return n}},controller:["$scope","header","body",function(t,e,n){t.header=e,t.body=n}]})},upload:function(t,n,r,i,o,a,u){return e.open({animation:!0,size:r,templateUrl:"app/manager/home/tripDetail/uploadTemplate.tpl.html",resolve:{header:function(){return t},body:function(){return n},pointId:function(){return i},tripId:function(){return o},fileId:function(){return a},media:["ReportRemoteService",function(t){return t.getMedia(o)}]},controller:["$scope","header","body","pointId","tripId","fileId","media","ReportRemoteService",function(t,e,n,r,i,o,a,u){t.header=e,t.body=n,t.pointId=r,t.tripId=i,t.media=a.data.media,t.uploadFile=function(){var t=document.querySelector("input[type=file]"),e=t.files[0],n={trip:i,content:e};u.uploadFile(n).then(function(){console.log("Upload successfull")},function(){console.log("Upload failed")})}}]})}}}])}(),function(){"use strict";angular.module("mytrip.trip",["ui.router"])}(),function(){"use strict";angular.module("mytrip.trip").controller("TripCtrl",["$scope","$state","trips","ReportRemoteService",function(t,e,n,r){t.filteredTrips=[],t.currentPage=1,t.numPerPage=10,t.maxSize=50,t.points=[{id:0,name:"",coordinates:{x:5e3,y:6e3},photoPath:""}],t.trips=n.data.results,void 0!==t.trips&&(t.totalItems=t.trips.length),t.getDetails=function(t){e.go("app.home.tripDetail",{tripId:t})},t.numPages=function(){return Math.ceil(t.todos.length/t.numPerPage)},t.$watch("currentPage + numPerPage",function(){var e=(t.currentPage-1)*t.numPerPage,n=e+t.numPerPage;t.filteredTrips=t.trips.slice(e,n)}),t.postTrip=function(){var e={name:t.name,description:t.description,startDate:t.startDate.toISOString().substring(0,10),endDate:t.endDate.toISOString().substring(0,10)};r.postTrip(e).success(function(t,e,n){modalService.confirmation("Sukces","Wycieczka dodana pomyślnie!"),console.log("Sukces!")}).error(function(t,e,n,r){modalService.confirmation("Błąd","Nie udało się dodać wycieczki!"),console.log("Data: "+t+"\n\n\n\nstatus: "+e+"\n\n\n\nheaders: "+n+"\n\n\n\nconfig: "+r)}).then(function(e){t.trips.push(e.data)}),t.clearForm()},t.uploadGpx=function(e){var n=t.trips,i=Object.keys(n).sort().reverse()[0],o=n[i],a=o.id+1;r.uploadGpx(e,a)},t.clearForm=function(){t.name="",t.description="",t.startDate="",t.endDate=""}}])}(),function(){"use strict";angular.module("mytrip.trip").config(["$stateProvider",function(t){t.state("app.home.trip",{url:"/trip",views:{"home@app.home":{controller:"TripCtrl",templateUrl:"app/manager/home/trip/trip.tpl.html"}},resolve:{trips:["ReportRemoteService",function(t){return t.getTrips()}]}})}])}(),function(){"use strict";angular.module("mytrip.trip").factory("ReportRemoteService",["$q","$http","ModalService",function(t,e,n,r){var i="http://40.69.212.228/";return{uploadGpx:function(t,n){var r=new FormData;console.log(t),r.append("file",new Uint8Array(t));return e.post(i+"id/uploadPath/",r,{transformRequest:angular.identity,headers:{"Content-Type":"application/json"}})},getTrips:function(){return e.get(i+"/trips")},getTrip:function(t){var n=i+"/trips/"+t;return e.get(n)},removeTrip:function(t){var n=i+"/trips/"+t;return e.delete(n)},editTrip:function(t){var n=i+"/trips/"+t.id+"/",r={name:t.name,description:t.description,points:t.points,media:[],startDate:t.startDate,endDate:t.endDate};return e.put(n,r)},editPoints:function(t){var n=i+"/trips/"+t.id+"/",r={name:t.name,description:t.description,points:t.points,media:[],startDate:t.startDate,endDate:t.endDate};return e.put(n,r)},postTrip:function(t){return t=angular.extend(t,{points:[],media:[]}),e.post(i+"/trips/",t)},uploadFile:function(t){var n=new FormData;return n.append("trip",t.trip),n.append("content",t.content),e.post(i+"media/",n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},getMedia:function(t){var n=i+"trips/"+t;return e.get(n)}}}])}(),function(){"use strict";angular.module("mytrip.view.tripDetail",["ui.router","mytrip.trip"])}(),function(){"use strict";angular.module("mytrip.view.tripDetail").controller("TripDetailCtrl",["$scope","$state","ReportRemoteService","trip","lodash","NgMap","ModalService",function(t,e,n,r,i,o,a){function u(){return moment().format("YYYY-MM-DD[T]HH:mm:ss[Z]")}t.trip=r.data;var p=0;t.start={},t.theWaypoints=[],t.end={},t.center=function(){var e=[52.222421,21.006185];return t.trip.points.length>0?(i.forEach(t.trip.points,function(t){e[0]+=Number(t.latitude),e[1]+=Number(t.longtitude)}),e[0]/=t.trip.points.length,e[1]/=t.trip.points.length,e):navigator.geolocation?void navigator.geolocation.getCurrentPosition(function(t){return e[0]=t.coords.latitude,e[1]=t.coords.longitude,e}):e=[52.222421,21.006185]}(),t.zoom=function(){if(i.size(t.trip.points)<=1)return 10;var e=i.maxBy(t.trip.points,function(t){return Number(t.latitude)}),n=i.minBy(t.trip.points,function(t){return Number(t.latitude)}),r=i.maxBy(t.trip.points,function(t){return Number(t.longtitude)}),o=i.minBy(t.trip.points,function(t){return Number(t.longtitude)}),a=360/(Math.abs(e.latitude)+Math.abs(n.latitude)),u=360/(Math.abs(r.longtitude)+Math.abs(o.longtitude));return i.max([i.ceil(a),i.ceil(u)])}(),t.sortedPoints=[],o.getMap().then(function(e){t.map=e,t.trip.points.length>0&&(p=t.trip.points[t.trip.points.length-1].id+1)}),t.removeTrip=function(t){n.removeTrip(t).then(function(t){e.go("app.home.trip")})},t.showMarkerDetails=function(t,e,n,r){a.upload("Marker details nr: "+e,"","md",e,n,r)},t.postEditedTrip=function(){var e,r;e=null!=t.newStartDate?t.newStartDate.toISOString().substring(0,10):t.trip.startDate,r=null!=t.newEndDate?t.newEndDate.toISOString().substring(0,10):t.trip.endDate;var i={id:t.trip.id,name:t.newName||t.trip.name,description:t.newDescription||t.trip.description,points:t.trip.points,startDate:e,endDate:r};n.editTrip(i).success(function(t,e,n){a.confirmation("Sukces","Wycieczka edytowana pomyślnie!"),console.log("Trip edited!")}).error(function(t,e,n,r){a.confirmation("Błąd","Edycja wycieczki nieudana!"),console.log("Data: "+t+"\n\n\n\nstatus: "+e+"\n\n\n\nheaders: "+n+"\n\n\n\nconfig: "+r)})},t.addPoint=function(e,r){var i=e.latLng.lat()||e.pixel.x,o=e.latLng.lng()||e.pixel.y;t.trip.points.push({id:p,timestamp:u(),elevation:1,latitude:i.toString().substring(0,11),longtitude:o.toString().substring(0,11)}),p++,n.editPoints(t.trip).success(function(){a.confirmation("Sukces","Dodano nowy punkt!")}).error(function(){a.confirmation("Bład","Nie dodano punktu!")})},t.removeMarker=function(e,n){t.removePoint(n)},t.removePoint=function(e){i.remove(t.trip.points,{id:e}),n.editPoints(t.trip).success(function(){a.confirmation("Sukces","Punkt usunięty pomyślnie!")}).error(function(){a.confirmation("Błąd","Niepowodzenie edycji punktów")})},t.$watchCollection("trip.points",function(){t.sortedPoints=[];var e=t.trip.points;e.sort(function(t,e){return t.timestamp<e.timestamp?-1:t.timestamp>e.timestamp?1:0});for(var n=0;n<e.length;n++){var r=e[n].latitude,i=e[n].longtitude;("string"==typeof r||r instanceof String)&&(r=parseFloat(r)),("string"==typeof i||i instanceof String)&&(i=parseFloat(i)),t.sortedPoints.push([r,i])}})}])}(),function(){"use strict";angular.module("mytrip.view.tripDetail").config(["$stateProvider",function(t){t.state("app.home.tripDetail",{url:"/trip/:tripId",views:{"home@app.home":{controller:"TripDetailCtrl",templateUrl:"app/manager/home/tripDetail/tripDetail.tpl.html"}},resolve:{trip:["ReportRemoteService","$stateParams",function(t,e){return t.getTrip(e.tripId)}]},onEnter:function(t,e){void 0!==t.tripId&&""!==t.tripId||e.go("app.home.trip")}})}])}(),function(t,e,n){e.module("mytrip.view.manager",["ui.router"]).config(function(t){t.state("app",{views:{"@":{controller:"ManagerCtrl",templateUrl:"app/manager/manager.tpl.html"},"header@app":{controller:"HeaderCtrl",templateUrl:"app/manager/header/header.tpl.html"},"footer@app":{controller:"FooterCtrl",templateUrl:"app/manager/footer/footer.tpl.html"}},resolve:{}})}).controller("ManagerCtrl",["$scope","$state",function(t,e){}])}(window,window.angular),function(t,e,n){e.module("mytrip.model.responseStatus",[]).factory("ResponseStatus",[function(){function t(t,e,n,r){this.status=t,this.errorMessage=e,this.objectId=n,this.extra=r}return t.build=function(e){return new t(e.status,e.errorMsg,e.objectId,e.extra)},t.apiResponseTransformer=function(n){return e.isArray(n)?n.map(t.build):t.build(n)},t.prototype.isSuccess=function(){return"success"===this.status},t}])}(window,window.angular),function(t,e,n){e.module("mytrip.notifications.appNotificationsService",[]).factory("AppNotificationsService",["$rootScope",function(t){return{loginConfirmed:function(e){t.$broadcast("event:auth-loginConfirmed",e)},logoutConfirmed:function(e){t.$broadcast("event:auth-logoutConfirmed",e)},loginRequired:function(){t.$broadcast("event:auth-loginRequired")}}}])}(window,window.angular),function(t,e,n){e.module("mytrip.notifications.modalService",["ui.bootstrap"]).factory("ModalService",["$rootScope","$uibModal",function(t,e){return{confirmation:function(t,n){return e.open({animation:!0,size:"lg",templateUrl:"notifications/appModalService/modalTemplate.tpl.html",resolve:{header:function(){return t},body:function(){return n}},controller:["$scope","header","body",function(t,e,n){t.header=e,t.body=n.toHtmlObject}]})}}}])}(window,window.angular),function(t,e,n){e.module("mytrip.remote.api",["mytrip.auth.userAuthService","mytrip.model.responseStatus"]).factory("API",["$http","$q","UserAuthService","ResponseStatus",function(t,e,n,r){function i(r,i,o,a){var u=e.defer();return r=r.toUpperCase(),i.method=r,i.headers=n.getAuthHeaders(),r.match(/POST|PUT/)&&(i.data=o),a&&(i.params=a),t(i).success(function(t){u.resolve(t)}).error(function(t,e){u.reject("HTTP Error: "+e)}),u.promise}function o(t){return{url:c+t}}function a(t){return{url:l+t}}function u(t){return{url:d+t}}function p(t,n,i,o){var a=e.defer();return t(n,o).then(i.apiResponseTransformer,function(){a.reject(new r("error","",0))}).then(function(t){a.resolve(t)},function(){a.reject()}),a.promise}function s(t,n,i){var o=e.defer();return t(n,i).then(r.apiResponseTransformer,function(){return new r("error","",0)}).then(function(t){t.isSuccess()?o.resolve(t):o.reject(t)}),o.promise}var c="api/secure",l="api",d="api/base";return{get:function(t,e){return i("get",u(t),null,e)},getBaseAPI:function(t,e){return i("get",u(t),e)},post:function(t,e,n){return i("post",o(t),e,n)},put:function(t,e,n){return i("put",o(t),e)},remove:function(t,e){return i("delete",o(t))},postUnAuth:function(t,e){return i("post",a(t),e)},postBaseApi:function(t,e){return i("post",u(t),e)},postAndResolve:function(t,e,n){return p(this.post,t,e,n)},getAndResolve:function(t,e,n){return p(this.get,t,e,n)},putWithStatus:function(t,e){return s(this.put,t,e)},postWithStatus:function(t,e){return s(this.post,t,e)},getWithStatus:function(t,e){return s(this.get,t,e)},removeWithStatus:function(t){return s(this.remove,t)},postBaseAPIWithStatus:function(t,e){return s(this.postBaseApi,t,e)}}}])}(window,window.angular);